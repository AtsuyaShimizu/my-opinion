# MVP要件定義書: 属性開示型SNS「My Opinion」

**バージョン**: 1.0
**作成日**: 2026-02-07
**ステータス**: 初版

---

## 目次

1. [プロダクトビジョン・ミッション](#1-プロダクトビジョンミッション)
2. [ターゲットユーザー](#2-ターゲットユーザー)
3. [機能要件（MVP）](#3-機能要件mvp)
4. [非機能要件](#4-非機能要件)
5. [技術スタック（確定版）](#5-技術スタック確定版)
6. [データモデル設計（概要）](#6-データモデル設計概要)
7. [画面一覧・画面遷移](#7-画面一覧画面遷移)
8. [Phase分け](#8-phase分け)
9. [法的対応事項](#9-法的対応事項)
10. [リスクと対策](#10-リスクと対策)

---

## 1. プロダクトビジョン・ミッション

### 1.1 ビジョン

エコーチェンバーに閉じた社会の分断を、「属性の可視化」と「反応の分析」によって自覚し、自発的に抜け出せる世界を実現する。

### 1.2 ミッション

学歴・職業・性別・支持政党/政治スタンス等の属性を明示した状態で議論できるSNSを提供し、ユーザーが「自分の立ち位置」を理解する手段を届ける。

### 1.3 解決する課題

- **エコーチェンバーの無自覚**: 既存SNS（X, Facebook等）ではアルゴリズムやフォロー構造により同質的な意見ばかりが表示され、ユーザーは偏りに気づけない
- **匿名議論の質の低下**: Yahoo!コメント等の匿名空間では無責任な発言・荒らしが横行し、建設的な議論が成立しにくい
- **属性を踏まえた議論の場の不在**: 「誰が」「どの立場から」発言しているかが分からないため、意見の背景を理解した上での対話が困難

### 1.4 差別化ポイント

| 観点 | 既存サービス | My Opinion |
|------|------------|------------|
| 属性 | 匿名 or 実名 | 属性開示（個人特定せず属性のみ公開） |
| 分析 | なし | 投稿ごとの閲覧者属性分布 + Good/Bad比率を可視化 |
| 自己認知 | なし | エコーチェンバー指標で自分のフォロー偏りを可視化 |
| 議論の質 | 無秩序 | テーマ制 + 属性開示による責任ある発言 |

### 1.5 市場ポジション

「属性開示 x 議論特化 x 分析可視化」の交差点に位置し、既存サービスとの直接競合がない。日本国内の政治・社会議論プラットフォームは「属性を明示した上での継続的な議論の場」が空白であり、ここに参入する。

- 潜在市場規模（TAM）: 政治・社会問題に関心のあるSNS利用者 約1,060万〜1,420万人
- 初期ターゲット（SAM）: 10万〜30万人
- MVP段階の目標: MAU 1,000〜10,000人

---

## 2. ターゲットユーザー

### 2.1 ペルソナ1: 議論好きインテリ層（コアユーザー）

| 項目 | 詳細 |
|------|------|
| 年齢 | 28〜45歳 |
| 職業 | 企業勤務（総合職）、士業、研究者、公務員 |
| 学歴 | 大卒以上 |
| SNS利用 | X(Twitter)をニュース・意見発信に積極利用。はてなブックマーク、NewsPicksも利用 |
| 利用動機 | 自分の意見に対する多様な反応を知りたい。エコーチェンバーから抜け出したい。知的好奇心 |
| 課金意向 | 高い（分析機能に価値を感じる）。月額980円まで許容 |
| 推定構成比 | 全ユーザーの20-30% |

### 2.2 ペルソナ2: 社会参加意欲の高い若年層（ボリュームゾーン）

| 項目 | 詳細 |
|------|------|
| 年齢 | 18〜27歳 |
| 職業 | 大学生、大学院生、社会人1-5年目 |
| 学歴 | 大学在学中〜大卒 |
| SNS利用 | X(Twitter)、Instagram、TikTok。政治系インフルエンサーのフォロー |
| 利用動機 | 「どうせ変わらない」を超えたい。自分の立ち位置を知りたい |
| 課金意向 | 中程度。無料で十分使えることが前提。月額500円なら検討 |
| 推定構成比 | 全ユーザーの40-50% |

### 2.3 ペルソナ3: 情報感度の高いシニア層（拡大フェーズの獲得対象）

| 項目 | 詳細 |
|------|------|
| 年齢 | 50〜65歳 |
| 職業 | 管理職、経営者、退職後の知識層 |
| SNS利用 | Facebook、Yahoo!ニュース、新聞電子版 |
| 利用動機 | 若い世代の考えを知りたい。自分の経験・知見を活かしたい |
| 課金意向 | 高い（金銭的余裕あり）。月額980円に抵抗なし |
| 推定構成比 | 全ユーザーの15-20% |

### 2.4 ペルソナ4: 研究者・ジャーナリスト（B2B/インフルエンサー層）

| 項目 | 詳細 |
|------|------|
| 年齢 | 30〜60歳 |
| 職業 | 大学教員、シンクタンク研究員、記者、ライター |
| 利用動機 | 世論の可視化データを研究・記事に活用 |
| 課金意向 | 個人課金よりもB2B契約 |
| 推定構成比 | 全ユーザーの5-10% |

---

## 3. 機能要件（MVP）

### 3.1 認証（登録/ログイン）

#### 3.1.1 ユーザー登録

| 項目 | 仕様 |
|------|------|
| メールアドレス | 必須。メール認証（確認メール送信）を実施 |
| パスワード | 必須。8文字以上、英数字混合 |
| ユーザーID | 必須。英数字・アンダースコア、3〜20文字。一意制約。変更不可 |
| ユーザー名 | 必須。表示名。1〜30文字。変更可能 |
| 招待コード | 必須（Phase 0〜Phase 1）。有効な招待コードがないと登録不可 |
| 利用規約同意 | 必須。チェックボックスによる明示的同意 |
| プライバシーポリシー同意 | 必須。チェックボックスによる明示的同意 |
| 要配慮個人情報の取り扱い同意 | 必須。政治スタンス等が要配慮個人情報であること、公開範囲、利用目的を明示した上での個別同意。同意日時・内容・バージョンを記録 |

#### 3.1.2 ログイン

| 項目 | 仕様 |
|------|------|
| 認証方式 | メールアドレス + パスワード |
| セッション管理 | Supabase Auth によるJWTトークン管理 |
| パスワードリセット | メールによるリセットリンク送信 |

#### 3.1.3 ログアウト・退会

| 項目 | 仕様 |
|------|------|
| ログアウト | セッション破棄 |
| 退会 | 設定画面から申請。確認ダイアログ表示後、アカウントと関連データを削除（法的保持義務のあるデータを除く）。退会後30日間はデータ保持し、復旧可能とする |

### 3.2 プロフィール（属性入力・表示）

#### 3.2.1 属性項目一覧

| 属性 | 入力形式 | 必須/任意 | 選択肢 | 備考 |
|------|---------|----------|--------|------|
| ユーザーID | テキスト | 必須 | -- | 登録時に設定、変更不可。英数字・アンダースコア、3〜20文字 |
| ユーザー名 | テキスト | 必須 | -- | 表示名。1〜30文字。変更可能 |
| アイコン | 画像アップロード | 任意 | -- | JPG/PNG、最大2MB、正方形にクロップ。デフォルトアイコンあり |
| 自己紹介 | テキスト | 任意 | -- | 最大160文字 |
| 性別 | セレクトボックス | 任意 | 男性 / 女性 / その他 / 回答しない | |
| 年齢帯 | セレクトボックス | 任意 | 18-24 / 25-29 / 30-34 / 35-39 / 40-44 / 45-49 / 50-54 / 55-59 / 60-64 / 65歳以上 | 正確な年齢は収集しない |
| 学歴 | セレクトボックス | 任意 | 中学校卒 / 高校卒 / 専門学校卒 / 短大卒 / 大学卒 / 大学院卒（修士） / 大学院卒（博士） / その他 | |
| 職業 | セレクトボックス | 任意 | 会社員 / 公務員 / 自営業・フリーランス / 経営者・役員 / 専門職（医師・弁護士等） / 教育・研究職 / 学生 / 主婦・主夫 / パート・アルバイト / 無職 / 退職者 / その他 | |
| 支持政党 | セレクトボックス | 任意 | 自由民主党 / 立憲民主党 / 日本維新の会 / 公明党 / 国民民主党 / 日本共産党 / れいわ新選組 / 社会民主党 / 参政党 / その他 / 支持政党なし / 回答しない | 要配慮個人情報。個別同意が必須 |
| 政治スタンス | スライダー（5段階） | 任意 | 左派 / やや左派 / 中道 / やや右派 / 右派 | 要配慮個人情報。個別同意が必須 |

#### 3.2.2 属性の公開・表示ルール

- 任意項目は「非公開」を選択可能（プロフィール編集画面で切り替え）
- 投稿に表示される属性: ユーザー名、アイコン、公開設定された属性のみ
- 分析集計に利用される属性: 公開・非公開に関わらず、同意済みの属性は統計に利用される（統計利用は匿名化されることを同意フローで明示）
- 属性の変更は随時可能だが、過去の投稿に表示される属性は変更時点のものに更新される

#### 3.2.3 要配慮個人情報の同意フロー

1. 政治スタンス・支持政党の入力画面に遷移した際、専用の同意画面を表示
2. 同意画面に以下を明記:
   - 「政治スタンス・支持政党は法律上『要配慮個人情報』に該当します」
   - 公開される範囲（他ユーザーのプロフィール・投稿表示に使用）
   - 利用目的（SNS上での属性表示、評価分析への利用、匿名化統計の作成）
3. 「同意する」ボタンの押下で同意完了。同意日時・内容・バージョンをDBに記録
4. 同意はいつでも撤回可能。撤回時は該当属性を非公開化し、統計からも除外

### 3.3 投稿機能

#### 3.3.1 通常投稿

| 項目 | 仕様 |
|------|------|
| 文字数制限 | 最大200文字 |
| テーマ紐付け | 任意。テーマを選択して投稿可能 |
| 表示情報 | ユーザー名、アイコン、公開属性、投稿本文、投稿日時、Good数、Bad数 |
| 画像添付 | MVP対象外（Phase 2以降） |

#### 3.3.2 返信

| 項目 | 仕様 |
|------|------|
| 対象 | 任意の投稿に対して返信可能 |
| 文字数制限 | 最大200文字（通常投稿と同一） |
| スレッド表示 | 元投稿の下にネスト表示。1階層のみ（返信への返信は元投稿へのフラットな返信として扱う） |
| 表示情報 | 通常投稿と同一 |

#### 3.3.3 リポスト

| 項目 | 仕様 |
|------|------|
| 操作 | 投稿の「リポスト」ボタンを押下 |
| 表示 | リポストしたユーザー名と「リポスト」ラベル + 元投稿の全情報 |
| 引用リポスト | MVP対象外（Phase 2以降） |
| タイムライン反映 | リポストしたユーザーのフォロワーのタイムラインに表示 |

### 3.4 フォロー/フォロワー

| 項目 | 仕様 |
|------|------|
| フォロー | 任意のユーザーをフォロー可能。承認不要（公開アカウントのみ） |
| フォロー解除 | いつでも解除可能 |
| フォロワー一覧 | プロフィール画面で確認可能 |
| フォロー一覧 | プロフィール画面で確認可能 |
| フォロー上限 | MVP段階: 上限なし |

### 3.5 タイムライン

#### 3.5.1 メインタイムライン

| 項目 | 仕様 |
|------|------|
| 表示対象 | フォロー中ユーザーの投稿 + フォロー中ユーザーのリポスト |
| 並び順 | 新しい投稿が上（時系列降順） |
| ページネーション | 無限スクロール（cursor-based pagination） |
| 更新 | Pull-to-refresh または自動ポーリング（30秒間隔） |

#### 3.5.2 テーマタイムライン

| 項目 | 仕様 |
|------|------|
| 表示対象 | 特定テーマに紐付いた全投稿 |
| 並び順 | 新しい投稿が上（時系列降順） |
| アクセス | テーマ一覧画面から遷移 |

#### 3.5.3 全体タイムライン（探索用）

| 項目 | 仕様 |
|------|------|
| 表示対象 | 全ユーザーの公開投稿 |
| 並び順 | 新しい投稿が上（時系列降順） |
| 目的 | 新しいユーザーやテーマを発見するための探索導線 |

### 3.6 Good/Bad評価

| 項目 | 仕様 |
|------|------|
| 評価種類 | Good（好意的）/ Bad（否定的）の2値 |
| 操作 | 各投稿のGood/Badボタンを押下。1ユーザーにつき1投稿あたり1回のみ（切り替え・取り消し可能） |
| 表示（外部） | Good数は常に表示。Bad数は**投稿者本人のみ**閲覧可能（他ユーザーには非表示） |
| 表示（投稿者） | Good数 + Bad数 + 分析画面へのリンク |
| 評価時の記録 | 評価者のユーザーID、対象投稿ID、評価種類（Good/Bad）、評価日時、評価者の属性スナップショット |

**Bad数の非表示設計の根拠**: 既存SNS（YouTube、Instagram等）の傾向に倣い、ネガティブフィードバックの可視化による萎縮効果を防止する。ただし、投稿者自身は改善のために参照可能とし、分析機能で詳細を確認できる。

### 3.7 投稿分析

#### 3.7.1 分析表示条件

| 項目 | 仕様 |
|------|------|
| 閲覧権限 | 投稿者本人のみ |
| 最低サンプル数 | 閲覧者（評価者）が**20人未満**の場合、分析結果は非表示。「あとN人の評価で分析が見られます」と表示 |
| 各属性セルの最低サンプル数 | 属性クロス集計の各セルが**5人未満**の場合、そのセルは非表示（k-匿名化、k>=5） |

#### 3.7.2 基本分析（Free / Standard / Pro共通）

| 分析項目 | 内容 |
|---------|------|
| Good/Bad比率 | 全体のGood率・Bad率（円グラフ） |

#### 3.7.3 Standard分析（Standard / Pro）

| 分析項目 | 内容 |
|---------|------|
| 閲覧者属性分布 | 性別、年齢帯、学歴、職業、政治スタンス別の閲覧者数を棒グラフで表示 |
| 属性 x 評価クロス集計 | 各属性値ごとのGood/Bad比率を横棒グラフで表示 |

#### 3.7.4 Pro分析（Proのみ）

| 分析項目 | 内容 |
|---------|------|
| 時系列分析 | 評価の推移（日別Good/Bad数の折れ線グラフ） |
| 属性分布推移 | 閲覧者の属性構成比の時間変化 |

#### 3.7.5 エコーチェンバー指標

| プラン | 内容 |
|--------|------|
| Free | 簡易版: 自分のフォロー先の属性分布（偏り度をスコア化） |
| Standard | 詳細版: フォロー + 自分の投稿閲覧者の属性分布 |
| Pro | 詳細版 + 改善提案（「XX属性の投稿をもっと見てみましょう」等） |

### 3.8 招待コード

| 項目 | 仕様 |
|------|------|
| コード形式 | 8文字の英数字ランダム文字列 |
| 配布 | 登録済みユーザーに1人あたり2枚配布（設定で調整可能） |
| 利用制限 | 各コード1回限り使用可能 |
| 管理者機能 | 管理者は任意の枚数のコードを一括生成可能 |
| 有効期限 | 生成から30日間 |
| Phase移行 | Phase 2以降は招待コードを任意（なくても登録可能）に切り替え |

### 3.9 テーマ（討論トピック）

| 項目 | 仕様 |
|------|------|
| テーマ作成者 | MVP段階: 運営のみ。Phase 2以降: テーマ主催者制度で一般ユーザーにも開放 |
| テーマ構成 | タイトル（最大50文字）+ 説明文（最大500文字）+ 開始日 + 終了日（任意） |
| テーマ一覧 | アクティブなテーマを一覧表示。参加者数・投稿数を表示 |
| テーマ参加 | テーマに紐付けて投稿することで参加。明示的な「参加」ボタンは不要 |
| テーマ別タイムライン | テーマに紐付いた投稿のみを時系列で表示 |
| 運営テーマ | 毎週月曜に運営が1つの時事テーマを設定（Phase 0〜1） |

### 3.10 通知

| 通知種類 | トリガー | 通知方法 |
|---------|---------|---------|
| 返信通知 | 自分の投稿に返信がついた | アプリ内通知 |
| フォロー通知 | 新しいフォロワーがついた | アプリ内通知 |
| Good通知 | 自分の投稿にGoodがついた（まとめて通知） | アプリ内通知 |
| テーマ開始通知 | 新しいテーマが開始された | アプリ内通知 |
| 分析解放通知 | 自分の投稿の評価者が20人に達し、分析が閲覧可能になった | アプリ内通知 |

- 通知設定: 各通知種類ごとにON/OFF切り替え可能
- 通知一覧: 未読/既読の管理。通知一覧画面で確認
- メール通知: MVP段階ではアプリ内通知のみ。メール通知はPhase 2以降

### 3.11 シェアカード（分析画像生成）

| 項目 | 仕様 |
|------|------|
| 対象 | 自分の投稿の分析結果 |
| 生成内容 | 投稿本文（冒頭50文字）+ Good/Bad比率 + 主要属性別評価のサマリーグラフをOGP画像として生成 |
| 出力形式 | PNG画像（1200x630px、OGPサイズ） |
| シェア先 | X(Twitter)、その他のSNSへのシェアボタン |
| Free | 基本テンプレート（My Opinionロゴ入り） |
| Standard | カスタムテンプレート（色変更可能） |
| Pro | 全テンプレート + ロゴなし版 |
| 目的 | 外部SNSへの拡散によるオーガニック流入の獲得 |

### 3.12 通報機能

| 項目 | 仕様 |
|------|------|
| 通報対象 | 投稿、返信、ユーザー |
| 通報理由 | 属性差別 / 誹謗中傷 / 虚偽属性 / なりすまし / スパム / その他（自由記述） |
| 通報後の流れ | 通報受付 → 管理者確認（1営業日以内目標）→ 対応判断 → 結果通知 |
| 段階的制裁 | 警告 → 投稿制限（24時間）→ アカウント一時停止（7日間）→ アカウント凍結 |
| 不服申立て | 制裁を受けたユーザーは不服申立て可能（メールフォーム） |

### 3.13 管理者機能

| 機能 | 内容 |
|------|------|
| ユーザー管理 | ユーザー一覧、属性確認、アカウント停止/凍結 |
| 投稿管理 | 通報された投稿の確認、削除 |
| テーマ管理 | テーマの作成、編集、終了 |
| 招待コード管理 | コードの一括生成、利用状況確認 |
| 通報管理 | 通報一覧、対応ステータス管理 |
| 統計ダッシュボード | MAU、DAU、投稿数、評価数、通報数の確認 |

---

## 4. 非機能要件

### 4.1 パフォーマンス

| 項目 | 目標値 |
|------|--------|
| 初回ページロード | 3秒以内（LCP） |
| タイムライン表示 | 1秒以内 |
| 投稿送信〜表示 | 2秒以内 |
| 分析グラフ描画 | 3秒以内 |
| 同時接続ユーザー数 | 500人（MVP段階） |
| API応答時間 | 95パーセンタイルで500ms以内 |

### 4.2 セキュリティ

| 項目 | 対策 |
|------|------|
| 認証 | Supabase Auth（JWT）。パスワードはbcryptハッシュ化 |
| 通信 | 全通信HTTPS（TLS 1.2以上） |
| XSS対策 | 投稿内容のサニタイズ。React標準のエスケープ処理 |
| CSRF対策 | Supabase Auth のトークンベース認証で対応 |
| SQLインジェクション | Supabase クライアントライブラリのパラメータバインディング使用。Row Level Security（RLS）適用 |
| レート制限 | API呼び出しの頻度制限（投稿: 10回/分、評価: 30回/分） |
| 個人情報保護 | 要配慮個人情報の暗号化保存。アクセスログの記録。データベースのRLS適用 |
| 同意管理 | 要配慮個人情報の同意記録（日時・内容・バージョン）の永続保存 |
| データ削除 | 退会時のデータ削除フロー。法的保持義務のあるデータは例外的に保持期間を設定 |

### 4.3 可用性・スケーラビリティ

| 項目 | 目標 |
|------|------|
| 稼働率 | 99.5%以上（月間ダウンタイム3.6時間以内） |
| バックアップ | Supabase の自動バックアップ（日次） |
| スケーリング | Vercelのエッジ配信 + Supabaseのコネクションプーリング |
| 監視 | エラー監視（Sentry等）、外形監視（UptimeRobot等） |

### 4.4 対応環境

| 項目 | 対象 |
|------|------|
| ブラウザ | Chrome、Safari、Firefox、Edge（最新2バージョン） |
| デバイス | PC、スマートフォン（レスポンシブデザイン） |
| OS | Windows、macOS、iOS、Android |
| 言語 | 日本語のみ（MVP段階） |

---

## 5. 技術スタック（確定版）

### 5.1 構成図

```
[ユーザー]
    |
    v
[Vercel] --- Next.js (React) --- SSR/SSG + API Routes
    |
    v
[Supabase]
    ├── PostgreSQL (データベース)
    ├── Auth (認証)
    ├── Storage (画像ストレージ)
    └── Realtime (通知のリアルタイム配信)
```

### 5.2 技術選定

| レイヤー | 技術 | 選定理由 |
|---------|------|---------|
| フロントエンド | Next.js (React) / TypeScript | SSR対応、SEOに有利。将来のReact Native展開とコード共有可能 |
| バックエンドAPI | Next.js API Routes (Route Handlers) | 初期はフロントと同居で最短リリース。将来的にNestJS等に分離可能 |
| データベース | PostgreSQL (Supabase) | RLS対応、JSONB型で柔軟なスキーマ拡張。マネージドで運用負荷低 |
| 認証 | Supabase Auth | メール認証、JWT管理、ソーシャルログイン（将来対応）をマネージドで提供 |
| ストレージ | Supabase Storage | アイコン画像、シェアカード画像の保存 |
| ホスティング | Vercel (Pro) | Next.jsの最適なデプロイ先。エッジ配信、プレビュー環境 |
| UIライブラリ | Tailwind CSS + shadcn/ui | 高速なUIスタイリング。デザインシステムの構築 |
| グラフ描画 | Recharts or Chart.js | 分析機能のグラフ可視化 |
| OGP画像生成 | @vercel/og or satori | シェアカードのサーバーサイド画像生成 |
| 状態管理 | Zustand or Jotai | 軽量な状態管理 |
| フォームバリデーション | Zod + React Hook Form | 型安全なバリデーション |

### 5.3 インフラコスト（月額見込み）

| 項目 | MVP段階 |
|------|---------|
| Vercel Pro | $20/月 (約¥3,000) |
| Supabase Pro | $25/月 (約¥3,750) |
| ドメイン・DNS | 約¥200/月 |
| 監視・メール等 | 約¥3,000/月 |
| **合計** | **約¥10,000/月** |

---

## 6. データモデル設計（概要）

### 6.1 ER図（主要テーブル）

```
users ──┬──< posts ──< reactions
        │       │
        │       └──< replies (postsの自己参照)
        │
        ├──< follows (user_id → following_id)
        │
        ├──< user_attributes
        │
        ├──< consent_records
        │
        ├──< notifications
        │
        ├──< invite_codes
        │
        └──< reports

themes ──< theme_posts (posts との中間テーブル)
```

### 6.2 主要テーブル一覧

| テーブル名 | 概要 | 主要カラム |
|-----------|------|-----------|
| **users** | ユーザー基本情報 | id (UUID), email, user_handle (一意), display_name, avatar_url, bio, created_at, updated_at, status (active/suspended/banned) |
| **user_attributes** | ユーザー属性情報 | id, user_id (FK), gender, age_range, education, occupation, political_party, political_stance, is_public (各属性の公開フラグ), updated_at |
| **consent_records** | 同意記録 | id, user_id (FK), consent_type, consent_version, consented_at, revoked_at |
| **posts** | 投稿 | id (UUID), user_id (FK), content (200文字), parent_post_id (nullable, 返信元), repost_of_id (nullable, リポスト元), created_at |
| **reactions** | Good/Bad評価 | id, user_id (FK), post_id (FK), reaction_type (good/bad), reactor_attribute_snapshot (JSONB), created_at |
| **follows** | フォロー関係 | id, follower_id (FK), following_id (FK), created_at |
| **themes** | テーマ | id, title, description, created_by (FK), start_date, end_date, status (active/ended), created_at |
| **theme_posts** | テーマと投稿の紐付け | id, theme_id (FK), post_id (FK) |
| **notifications** | 通知 | id, user_id (FK), type, reference_id, message, is_read, created_at |
| **invite_codes** | 招待コード | id, code (一意), created_by (FK), used_by (FK, nullable), expires_at, used_at |
| **reports** | 通報 | id, reporter_id (FK), target_type (post/user), target_id, reason, detail, status (pending/reviewed/resolved), reviewed_by, created_at, resolved_at |
| **admin_actions** | 管理者アクション記録 | id, admin_id (FK), action_type, target_type, target_id, reason, created_at |

### 6.3 RLS（Row Level Security）ポリシー

| テーブル | SELECT | INSERT | UPDATE | DELETE |
|---------|--------|--------|--------|--------|
| users | 全ユーザー（公開情報のみ） | 本人 | 本人 | 本人（論理削除） |
| user_attributes | 公開フラグがtrueの場合は全ユーザー、falseは本人のみ | 本人 | 本人 | 本人 |
| posts | 全ユーザー | 認証済みユーザー | 本人 | 本人 + 管理者 |
| reactions | 投稿者は自投稿への全評価を閲覧可、一般ユーザーはGood数のみ | 認証済みユーザー | 本人 | 本人 |
| follows | 全ユーザー | 認証済みユーザー | -- | 本人 |

---

## 7. 画面一覧・画面遷移

### 7.1 画面一覧

| # | 画面名 | パス | 概要 |
|---|--------|------|------|
| 1 | ランディングページ | `/` | サービス紹介、登録/ログイン導線 |
| 2 | ユーザー登録 | `/signup` | メール・パスワード・ユーザーID入力、招待コード入力、利用規約同意 |
| 3 | メール認証完了 | `/verify` | メール認証完了画面 |
| 4 | ログイン | `/login` | メール・パスワード入力 |
| 5 | パスワードリセット | `/reset-password` | リセットメール送信 |
| 6 | 初回プロフィール設定 | `/onboarding` | 属性入力、要配慮個人情報の同意フロー |
| 7 | メインタイムライン | `/home` | フォロー中ユーザーの投稿一覧 |
| 8 | 全体タイムライン | `/explore` | 全ユーザーの公開投稿一覧 |
| 9 | テーマ一覧 | `/themes` | アクティブなテーマの一覧 |
| 10 | テーマ詳細 | `/themes/:id` | テーマ別タイムライン |
| 11 | 投稿詳細 | `/posts/:id` | 投稿本文 + 返信スレッド |
| 12 | 投稿分析 | `/posts/:id/analysis` | 投稿の分析グラフ（投稿者本人のみ） |
| 13 | プロフィール | `/users/:handle` | ユーザー情報 + 投稿一覧 |
| 14 | プロフィール編集 | `/settings/profile` | 属性・アイコン・表示名の編集 |
| 15 | 通知一覧 | `/notifications` | 通知の一覧 |
| 16 | フォロー/フォロワー一覧 | `/users/:handle/follows` | フォロー・フォロワーの一覧 |
| 17 | エコーチェンバー指標 | `/settings/echo-chamber` | 自分のフォロー偏り度の可視化 |
| 18 | 設定 | `/settings` | 通知設定、アカウント設定、退会 |
| 19 | シェアカード生成 | `/posts/:id/share` | 分析結果のOGP画像生成・シェア |
| 20 | 管理者ダッシュボード | `/admin` | ユーザー管理、通報管理、テーマ管理、統計 |

### 7.2 画面遷移図

```
[ランディング] ──→ [ユーザー登録] ──→ [メール認証完了] ──→ [初回プロフィール設定] ──→ [メインタイムライン]
      │                                                                                       │
      └──→ [ログイン] ──→ [メインタイムライン] ←──────────────────────────────────────────────────┘
                                │
                ┌───────────────┼───────────────┬──────────────────┐
                v               v               v                  v
         [全体タイムライン]  [テーマ一覧]    [通知一覧]          [設定]
                │               │                                  │
                v               v                                  v
         [投稿詳細]       [テーマ詳細]                    [プロフィール編集]
           │    │               │                         [エコーチェンバー指標]
           │    v               v
           │  [返信]     [投稿（テーマ付き）]
           v
     [投稿分析] ──→ [シェアカード生成]

[プロフィール] ──→ [フォロー/フォロワー一覧]
```

### 7.3 主要画面のグローバルナビゲーション

ボトムナビゲーション（モバイル）/ サイドナビゲーション（PC）:

1. **ホーム** (メインタイムライン)
2. **探索** (全体タイムライン)
3. **投稿** (新規投稿モーダル)
4. **テーマ** (テーマ一覧)
5. **通知** (通知一覧、未読バッジ)
6. **プロフィール** (自分のプロフィール)

---

## 8. Phase分け

### 8.1 MVP（Phase 1）--- 本要件定義書のスコープ

| カテゴリ | 機能 |
|---------|------|
| 認証 | メール登録/ログイン、パスワードリセット、退会 |
| プロフィール | 属性入力（性別・年齢帯・学歴・職業・支持政党・政治スタンス）、公開/非公開切り替え、アイコン |
| 投稿 | 通常投稿（200文字）、返信、リポスト |
| タイムライン | メイン（フォロー）、全体（探索）、テーマ別 |
| フォロー | フォロー/フォロワー |
| 評価 | Good/Bad（Bad数は投稿者のみ閲覧可能） |
| 分析 | Good/Bad比率、閲覧者属性分布、属性x評価クロス集計、エコーチェンバー指標（簡易版） |
| テーマ | 運営によるテーマ作成、テーマ別タイムライン |
| 招待 | 招待コード制（ウェーブ制） |
| 通知 | アプリ内通知（返信、フォロー、Good、テーマ開始、分析解放） |
| シェア | シェアカード（分析画像生成、外部SNSシェア） |
| 通報 | 通報機能、管理者による対応フロー |
| 法的対応 | 利用規約、プライバシーポリシー、コミュニティガイドライン、要配慮個人情報同意フロー、Cookie同意バナー |
| 管理 | 管理者ダッシュボード（ユーザー管理、通報管理、テーマ管理、基本統計） |

### 8.2 Phase 2（成長期: MAU 1,000〜10,000）

| カテゴリ | 機能 |
|---------|------|
| 分析 | 時系列分析、属性分布推移、エコーチェンバー指標（詳細版 + 改善提案） |
| 課金 | サブスクリプション（Free/Standard/Pro）、Verified（eKYC） |
| テーマ | テーマ主催者制度（一般ユーザーによるテーマ作成） |
| 投稿 | 引用リポスト、画像添付 |
| 異論ミックス | 反対属性の投稿を少量差し込むスライダー |
| 通知 | メール通知、週次レポート |
| モデレーション | AIフィルタリング（差別的表現の自動検出）、透明性レポート |
| B2B | Academic/Media向けデータ提供パイロット |
| 特商法対応 | サブスクリプション課金に伴う特定商取引法表示 |
| 検索 | ユーザー検索、投稿検索 |
| ブロック/ミュート | 特定ユーザーのブロック・ミュート機能 |
| SEO | コンテンツマーケティング用ランディングページ |

### 8.3 Phase 3（スケール期: MAU 10,000〜50,000+）

| カテゴリ | 機能 |
|---------|------|
| iOS | React Nativeによるネイティブアプリ |
| 年収帯 | Verified + eKYCとセットで年収帯属性を追加 |
| AI分析 | AIによるユーザー人物分析（最大500字） |
| レコメンド | 高度なレコメンドアルゴリズム（興味テーマ、フォロー候補） |
| B2B | Enterprise向けデータ提供、カスタムダッシュボード |
| 広告 | 直販スポンサー、コンテキスト広告 |
| GDPR | 海外展開に伴うGDPR対応（DPIA、DPO任命等） |
| API分離 | Next.js API Routes からNestJS等の独立バックエンドへの分離 |
| バッチ処理 | 集計・分析のバッチ処理基盤（Fly.io / Render等） |
| 国際化 | 多言語対応（英語等） |

---

## 9. 法的対応事項

### 9.1 MVP前に必須の法的対応

| # | 対応事項 | リスク | 詳細 |
|---|----------|--------|------|
| 1 | **要配慮個人情報の同意取得フロー** | 高 | 政治スタンス・支持政党は「要配慮個人情報」（個人情報保護法第2条第3項）に該当。オプトイン方式の明示的同意が必須。同意の記録（日時・内容・バージョン）を保存。同意撤回の仕組みも必須 |
| 2 | **プライバシーポリシーの策定** | 高 | 事業者情報、取得する個人情報の項目、利用目的、要配慮個人情報の取り扱い、第三者提供の条件、開示・訂正・削除請求の対応方法、Cookie利用、データ保存期間、安全管理措置、問い合わせ窓口を記載 |
| 3 | **利用規約の策定** | 高 | サービス定義、利用資格（18歳以上推奨）、属性情報の取り扱い、禁止事項（属性差別、虚偽属性、個人特定行為、属性情報の外部流出等）、モデレーションポリシー、免責事項、準拠法（日本法）、管轄裁判所 |
| 4 | **コミュニティガイドライン** | 高 | 禁止行為の具体例、段階的制裁（警告→一時停止→凍結）、通報方法を明記 |
| 5 | **通報・削除フロー** | 高 | プロバイダ責任制限法（情報流通プラットフォーム対処法）に基づく対応。通報受付→確認→削除判断→理由通知→不服申立て→記録保存 |
| 6 | **発信者情報開示請求対応** | 高 | IPアドレス・メールアドレス等の開示義務への対応フロー整備。顧問弁護士への連絡体制構築 |
| 7 | **分析データの最低サンプル数制限** | 高 | 属性x評価のクロス集計は n < 20 で非表示。各セルは k < 5 で非表示（k-匿名化） |
| 8 | **外部送信規律対応** | 中 | Cookie同意バナーの実装。プライバシーポリシーに外部送信先・送信情報・利用目的を記載 |
| 9 | **顧問弁護士の選定** | 高 | IT法務・個人情報保護法に精通した弁護士によるリーガルレビュー |

### 9.2 特に注意すべき法的論点

#### 要配慮個人情報の取得（個人情報保護法）
- 政治スタンス・支持政党 → 「信条」に該当し、要配慮個人情報
- オプトイン方式の明示的同意が必須（黙示の同意・オプトアウト方式は不可）
- 第三者提供もオプトアウト方式が禁止。本人の個別同意が必要

#### 属性に基づく差別リスク（名誉毀損・ヘイトスピーチ）
- 本サービスは属性を公開して議論する特性上、属性に基づく差別的投稿が通常のSNSより発生しやすい
- 刑法230条（名誉毀損）、刑法231条（侮辱）、民法709条（不法行為）のリスク
- 運営者の共同不法行為（民法719条）リスク: 違法投稿を放置した場合
- コミュニティガイドライン + モデレーション体制で対策

#### 著作権（著作権法）
- ユーザー投稿の著作権はユーザーに帰属
- 利用規約でサービス運営に必要な範囲の非独占的ライセンスを取得
- 「著作権を運営者に譲渡する」条項は消費者契約法上無効リスクあり

#### 免責条項の設計（消費者契約法）
- 事業者の損害賠償責任を全部免除する条項は無効（消費者契約法8条）
- 「軽過失の場合に限り、利用料金を上限として賠償する」程度の制限が実務的な落としどころ

---

## 10. リスクと対策

### 10.1 プロダクトリスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|---------|------|
| **属性詐称（嘘の属性入力）** | 高 | 高 | MVP段階はメール認証のみで許容。Phase 2でVerified（eKYC）制度を導入し、確認済みバッジで信頼性を可視化。統計的外れ値の検知も将来導入 |
| **荒らし・誹謗中傷** | 高 | 高 | 招待制による初期品質管理 + 通報・段階的制裁フロー + コミュニティガイドライン。属性に基づく差別はサービス特有リスクとして特に注視 |
| **初期ユーザー不足で分析が成立しない** | 高 | 中 | n < 20非表示ルールで不十分なデータの露出を防止。「あとN人で分析解放」の表示で動機付け。テーマ空間で「小さな村」を成立させる設計 |
| **政治的偏りの固定化** | 中 | 中 | Phase 0でバランスのとれたシードユーザーを確保。多様な立場からの参加を促すテーマ設計。Phase 2で異論ミックス機能 |

### 10.2 法的リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|---------|------|
| **要配慮個人情報の取り扱い違反** | 高 | 低 | 明示的同意フロー + 同意記録の保存 + 同意撤回機能。顧問弁護士によるリーガルレビュー |
| **名誉毀損・誹謗中傷の責任追及** | 高 | 中 | プロバイダ責任制限法の適切な適用。通報対応フロー（1営業日以内目標）。発信者情報開示請求への対応体制 |
| **個人特定（属性の組み合わせによる）** | 高 | 中 | k-匿名化（k>=5）。属性の粒度を粗く設計（年齢は「帯」、学歴は大分類）。個人特定行為の禁止を利用規約に明記 |
| **個人情報保護法の改正対応** | 中 | 中 | 法改正動向の継続的モニタリング。柔軟に対応できるデータ設計 |

### 10.3 ビジネスリスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|---------|------|
| **収益化の遅れ** | 中 | 中 | インフラコストを最小化（月額約¥10,000）し、黒字化ハードルを低く設定。MAU 800〜1,350人で黒字化可能 |
| **ユーザー獲得の停滞** | 高 | 中 | シェアカードによるオーガニック拡散 + テック系メディアPR + 選挙連動キャンペーン + 大学連携。複数チャネルを並行 |
| **競合の参入** | 中 | 低 | 「属性開示 x 分析可視化」の組み合わせは参入障壁。早期のデータ蓄積とコミュニティ形成がモート |

### 10.4 技術リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|---------|------|
| **Supabaseの障害・制限** | 中 | 低 | Supabase Proプランで安定性を確保。重要データの外部バックアップ。将来的にセルフホスティング移行の選択肢を残す |
| **分析処理の負荷** | 中 | 中 | MVP段階は投稿ごとのリアルタイム集計。ユーザー増加時はバッチ処理に移行（Phase 2〜3） |
| **セキュリティインシデント** | 高 | 低 | Supabase RLS + 暗号化 + レート制限。定期的なセキュリティレビュー |

---

## 付録: 収益モデル（参考）

### 料金テーブル（Phase 2導入予定）

| | Free | Standard (¥500/月) | Pro (¥980/月) |
|---|---|---|---|
| 投稿・返信・リポスト | 無制限 | 無制限 | 無制限 |
| Good/Bad評価 | 可能 | 可能 | 可能 |
| 基本分析（Good/Bad比率） | あり | あり | あり |
| 詳細分析（属性分布 + クロス集計） | なし | あり | あり |
| 時系列分析 | なし | なし | あり |
| エコーチェンバー指標 | 簡易版 | 詳細版 | 詳細版 + 改善提案 |
| シェアカード | 基本テンプレ | カスタム | 全テンプレ + ロゴなし |
| 広告 | あり（控えめ） | なし | なし |
| 年額 | -- | ¥5,000/年（17%OFF） | ¥9,800/年（17%OFF） |

### 黒字化目安

- インフラ費黒字化: MAU 800〜1,350人、課金率3-5%（リリース後3〜6ヶ月）
- 人件費込み黒字化: MAU 10,000、課金率5% + B2B開始（リリース後12〜18ヶ月）

---

**注記**: 本要件定義書は市場調査および法律調査の結果を統合して作成されたものであり、実装着手前に以下のレビューを推奨する:
1. IT法務・個人情報保護法に精通した弁護士によるリーガルレビュー
2. UI/UXデザイナーによる画面設計レビュー
3. チーム内での技術的実現性レビュー
